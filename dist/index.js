import{zodResolver as e}from"@hookform/resolvers/zod";import{useForm as t,useFormState as n,get as a,useFormContext as l,useController as r,FormProvider as s}from"react-hook-form";import i from"lodash/merge";import o from"zod";import{useMemo as c,memo as d,useId as m}from"react";import{jsx as u,jsxs as p}from"react/jsx-runtime";import f from"react-select";function h(e,t){const n=e=>{const t={},a={};for(const l in e){const r=e[l];if("type"in r&&"spec"===r.type)t[l]=r.schema,a[l]=r.defaultValue;else{const e=n(r);t[l]=o.object(e.shape),a[l]=e.defaults}}return{shape:t,defaults:a}},{shape:a,defaults:l}=n(e);return{schema:t?t(o.object(a)):o.object(a),defaultValues:l}}const b=(n,a)=>({form:t({...a,defaultValues:i({},n.defaultValues,a?.defaultValues),resolver:e(n.schema)}),attach:(e,t)=>({name:e,...c(()=>t,[])})}),y={string:(e=o.string(),t="")=>({type:"spec",schema:o.preprocess(e=>e?String(e):void 0,o.union([o.string(),o.undefined()])).pipe(e),defaultValue:t}),number:(e=o.number(),t="")=>({type:"spec",schema:o.preprocess(e=>e?Number(e):void 0,o.union([o.number(),o.undefined()])).pipe(e),defaultValue:t}),custom:(e,t=void 0)=>({type:"spec",schema:e,defaultValue:t})};function g(e){const t=t=>{if(!t?.name)return null;const{name:n,label:a,id:l,...r}=t,s=l||m();/* @__PURE__ */
return u(N,{name:n,label:a,id:s,children:/* @__PURE__ */u(e,{name:n,...r,id:s})})};return t.displayName="withFormControl",d(t)}const N=({name:e,id:t,label:n,children:a})=>{const l=V(e);/* @__PURE__ */
return p("div",{className:"form-control",children:[
/* @__PURE__ */u(v,{label:n||null,id:t}),a,
/* @__PURE__ */u(S,{message:l?.message||null,messageType:l?.type||null})]})},v=d(({label:e,id:t})=>e?/* @__PURE__ */u("label",{htmlFor:t,children:e}):null);v.displayName="FieldLabel";const S=({message:e,messageType:t})=>e?/* @__PURE__ */u("div",{className:"invalid-feedback","data-feedback-type":t,children:e}):null,V=e=>{const{errors:t}=n({name:e});return a(t,e)||null},F=(e,t=!1)=>{const{register:n,control:a}=l();if(t){const{field:t}=r({name:e,control:a});return t}return n(e)},x=({form:e,children:t,disabled:n=!1,...a})=>/* @__PURE__ */u(s,{...e,children:/* @__PURE__ */u("form",{noValidate:!0,...a,onSubmit:e.handleSubmit(a?.onSubmit||j(a?.action||"",a?.method)),children:/* @__PURE__ */u("fieldset",{className:"form-scope",disabled:n,children:t})})}),j=(e,t="POST")=>async n=>{const a=new FormData;for(const e in n)a.append(e,n[e]);await fetch(e,{method:t,body:JSON.stringify(n)}).then(async e=>{})},k=({name:e,type:t="text",...n})=>/* @__PURE__ */u("input",{type:t,...n,...F(e)});k.displayName="FieldInput";const T=g(k),w=({name:e,...t})=>/* @__PURE__ */u("input",{type:"hidden",...t,...F(e)}),z=({name:e,...t})=>/* @__PURE__ */u("textarea",{...t,...F(e)});z.displayName="FieldTextarea";const D=g(z),I=({children:e,...t})=>/* @__PURE__ */u("select",{...t,children:e});I.displayName="FieldNativeSelect";const L=g(I),O=({name:e,...t})=>{const n=F(e,!0);/* @__PURE__ */
return u(f,{...t,...n,classNamePrefix:"react-select",inputId:t?.id,id:void 0})};O.displayName="FieldNativeSelect";const P=g(O),C=d(({label:e,autoHide:t=!1,...a})=>{const{isDirty:l,isSubmitting:r,isLoading:s}=n();return t&&!l?null:/* @__PURE__ */u("button",{type:"submit",...a,children:e||null})});export{w as FieldHidden,T as FieldInput,L as FieldNativeSelect,P as FieldReactSelect,D as FieldTextarea,x as Form,C as Submit,b as createForm,h as createSchema,F as fieldBind,y as spec,g as withFormControl};
